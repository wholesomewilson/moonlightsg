<div class="walletwrapper">
  <div class="col-xs-5 col-sm-4 col-sm-offset-1 col-md-offset-2 col-md-4 col-lg-offset-3 col-lg-2 account_settings_full">
    <h3>Account Settings</h3>
    <%= render 'account_setting_template' %>
  </div>
  <div class="col-sm-7 col-md-4 text-center">
    <div class="row">
      <div class="col-xs-12 total_balance_wrapper">
        Total Balance
      </div>
    </div>
    <div class="row balance_wrapper">
      <div class="col-xs-12 balance_first">
        <% if @wallet.balance.present? %>
          <%= number_to_currency(@wallet.balance) %>
        <% else %>
          $0
        <% end %>
      </div>
    </div>
    <% if @wallet.balance.present? %>
      <% if @wallet.balance > 5 %>
        <div class="row withdraw_wrapper">
          <div class="col-xs-12 withdraw_first">
            <%= button_tag "Cash Out", type:"button", class:"btn-cash", id:"btn-cash-out"%>
          </div>
          <%= form_for @transaction, :url => wallet_create_transaction_path(:id => @wallet.id) do |f| %>
            <div class="col-xs-12">
              <div class="col-xs-6 col-xs-offset-3">
                <div class="cash_out_header">
                  Cash Out Amount
                </div>
                <label for="transaction_amount" class="transaction_amount_label">$</label>
                <%= f.number_field :amount, class:"form-control text-center", value: @wallet.balance %>
                <%= f.hidden_field :transaction_type, value: 2 %>
              </div>
              <div class="col-xs-12 wrong_cash_out_amt" id="exceed_cash_out_amt">You don't have this much in your wallet!</div>
              <div class="col-xs-12 wrong_cash_out_amt" id="under_cash_out_amt">Minimum cash out amount is $5!</div>
            </div>
            <div class="col-xs-12 transfer_wrapper">
              <%= render partial: 'transfer_to', locals:{ f: f } %>
            </div>
            <div class="col-xs-12 withdraw_btn_wrapper">
              <%= f.button "Withdraw", class:"btn-cash", id:"btn-withdraw"%>
            </div>
          <% end %>
          <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, class:"edit_form_wallet"}, remote:true) do |s| %>
          <div class="row">
            <div class="col-xs-6 col-xs-offset-3">
              <%= s.label :first_name, 'First Name' %><br>
              <%= s.text_field :first_name, class:"form-control" %><br>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6 col-xs-offset-3">
              <%= s.label :last_name, 'Last Name' %><br>
              <%= s.text_field :last_name, class:"form-control" %><br>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6 col-xs-offset-3">
              <%= s.label :contact_number, 'Contact Number' %><br>
              <%= s.number_field :contact_number, class:"form-control" %><br>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6 col-xs-offset-3">
              <%= s.submit "Update", class:"btn btn-account", id:"update_button" %>
            </div>
          <% end %>
          </div>
        </div>
      <% else %>
        <div class="row no_withdraw_wrapper">
          <div class="col-xs-12">
            Just <strong><%= number_to_currency(5 - @wallet.balance) %></strong> more and you can cash out!
          </div>
        </div>
      <% end %>
    <% end %>
    <div class="row trans_stats_header">
      <div class="col-xs-6 withdraw_first">
        <%= button_tag "Transactions", type:"button", class:"btn-transaction", id:"btn-trans"%>
      </div>
      <div class="col-xs-6 withdraw_first">
        <%= button_tag "Statistics", type:"button", class:"btn-statistics", id:"btn-stats"%>
      </div>
    </div>
    <div class="row transactions_wrapper">
      <% @transactions.each do |transaction| %>
        <% if transaction.transaction_type == 1 %>
          <div class="col-xs-12 transaction_add">
            <div class="col-xs-4">
              <%= transaction.created_at.strftime('%e %b %Y') %>
            </div>
            <div class="col-xs-4">
              <div class="plussign">+</div><%= number_to_currency(transaction.amount) %>
            </div>
            <div class="col-xs-4">
              <%= link_to 'Bounty', lesson_path(transaction.lesson_id) %>
            </div>
          </div>
        <% elsif transaction.transaction_type == 2 %>
          <div class="col-xs-12 transaction_minus">
            <div class="col-xs-4">
              <%= transaction.created_at.strftime('%e %b %Y') %>
            </div>
            <div class="col-xs-4">
              <div class="plussign">-</div><%= number_to_currency(transaction.amount) %>
            </div>
            <div class="col-xs-4">
              Cash Out
            </div>
          </div>
          <% else %>
            <div class="col-xs-12 transaction_minus">
              <div class="col-xs-4">
                <%= transaction.created_at.strftime('%e %b %Y') %>
              </div>
              <div class="col-xs-4">
                -
              </div>
              <div class="col-xs-4">
                Cash Out Processed
              </div>
            </div>
        <% end %>
      <% end %>
    </div>

</div>
<script>

$("#btn-stats").on('click', function(){
  $(this).css('border-bottom', '1px solid #23B3B9')
  $("#btn-trans").css('border-bottom', 'none')
})

$("#btn-trans").on('click', function(){
  $(this).css('border-bottom', '1px solid #23B3B9')
  $("#btn-stats").css('border-bottom', 'none')
})

$('.btn-edit-details').on('click', function(){
  $('.edit_form_wallet').show()
  $('.transfer_wrapper').hide()
  $('.withdraw_btn_wrapper').hide()
})

$('#transaction_amount').on('change',function(){
  var balance = parseFloat($('.balance_first').text().replace('$', '')).toFixed(2)
  if($(this).val() > balance){
    $(this).val(balance)
    $('#exceed_cash_out_amt').show()
    setTimeout(function() {
      $('#exceed_cash_out_amt').hide()
    }, 3000);
  }
  if($(this).val() < 5){
    $('#under_cash_out_amt').show()
    setTimeout(function() {
      $('#under_cash_out_amt').hide()
    }, 3000);
  }
})

$('#btn-cash-out').on('click', function(){
  $(this).hide()
  $('.transfer_wrapper').show()
  $('.withdraw_btn_wrapper').show()
  $('.new_transaction').show()
})

$('#btn-withdraw').on('click', function(e){
  var balance = parseFloat($('.balance_first').text().replace('$', '')).toFixed(2)
  if($('#transaction_amount').val() > balance || $('#transaction_amount').val() < 4.99 ){
    e.preventDefault()
  }
})

</script>
